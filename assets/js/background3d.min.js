if(THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){e=e||{};var s,l,c,p,d,h,E,f,u,m,v,y,x,R,T,w,g,S,H,M=this,C=new THREE.Projector,i=void 0!==e.canvas?e.canvas:document.createElement("canvas"),b=i.width,z=i.height,V=Math.floor(b/2),j=Math.floor(z/2),O=0,L=0,A=b,P=z,n=1,B=i.getContext("2d",{alpha:!0===e.alpha}),t=new THREE.Color(16711680),o=1,a=1,N=0,W=null,k=null,F=null,U=null,I=null,r=[],D=new THREE.Color,G=new THREE.Color,X=new THREE.Color,Y=new THREE.Color,q={},$=new THREE.Box2,J=new THREE.Box2,K=new THREE.Box2,Q=new THREE.Color,Z=new THREE.Color,_=new THREE.Color,ee=new THREE.Vector3,re=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Matrix3;function ne(e,r,t){he(t.opacity),Ee(t.blending);var i=r.scale.x*V,n=r.scale.y*j,o=Math.sqrt(i*i+n*n);if(K.min.set(e.x-o,e.y-o),K.max.set(e.x+o,e.y+o),t.isSpriteMaterial){var a=t.map;if(null!==a){var s=q[a.id];if(void 0!==s&&s.version===a.version||(s=ce(a),q[a.id]=s),void 0!==s.canvas){ye(s.canvas);var l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,d=l.width*a.repeat.x,h=l.height*a.repeat.y,E=i/d,f=n/h;B.save(),B.translate(e.x,e.y),0!==t.rotation&&B.rotate(t.rotation),B.translate(-i/2,-n/2),B.scale(E,f),B.translate(-c,-p),B.fillRect(c,p,d,h),B.restore()}}else ye(t.color.getStyle()),B.save(),B.translate(e.x,e.y),0!==t.rotation&&B.rotate(t.rotation),B.scale(i,-n),B.fillRect(-.5,-.5,1,1),B.restore()}else t.isSpriteCanvasMaterial?(ve(t.color.getStyle()),ye(t.color.getStyle()),B.save(),B.translate(e.x,e.y),0!==t.rotation&&B.rotate(t.rotation),B.scale(i,n),t.program(B),B.restore()):t.isPointsMaterial&&(ye(t.color.getStyle()),B.save(),B.translate(e.x,e.y),0!==t.rotation&&B.rotate(t.rotation),B.scale(i*t.size,-n*t.size),B.fillRect(-.5,-.5,1,1),B.restore())}function oe(e,r,t,i){if(he(i.opacity),Ee(i.blending),B.beginPath(),B.moveTo(e.positionScreen.x,e.positionScreen.y),B.lineTo(r.positionScreen.x,r.positionScreen.y),i.isLineBasicMaterial){if(fe(i.linewidth),ue(i.linecap),me(i.linejoin),i.vertexColors!==THREE.VertexColors)ve(i.color.getStyle());else{var n=t.vertexColors[0].getStyle(),o=t.vertexColors[1].getStyle();if(n===o)ve(n);else{try{var a=B.createLinearGradient(e.positionScreen.x,e.positionScreen.y,r.positionScreen.x,r.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}ve(a)}}B.stroke(),K.expandByScalar(2*i.linewidth)}else i.isLineDashedMaterial&&(fe(i.linewidth),ue(i.linecap),me(i.linejoin),ve(i.color.getStyle()),xe([i.dashSize,i.gapSize]),B.stroke(),K.expandByScalar(2*i.linewidth),xe([]))}function ae(e,r,t,i,n,o,a,s){if(M.info.render.vertices+=3,M.info.render.faces++,he(s.opacity),Ee(s.blending),E=e.positionScreen.x,f=e.positionScreen.y,u=r.positionScreen.x,m=r.positionScreen.y,v=t.positionScreen.x,y=t.positionScreen.y,function(e,r,t,i,n,o){B.beginPath(),B.moveTo(e,r),B.lineTo(t,i),B.lineTo(n,o),B.closePath()}(E,f,u,m,v,y),(s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial)&&null===s.map)G.copy(s.color),X.copy(s.emissive),s.vertexColors===THREE.FaceColors&&G.multiply(a.color),D.copy(Q),re.copy(e.positionWorld).add(r.positionWorld).add(t.positionWorld).divideScalar(3),function(e,r,t){for(var i=0,n=c.length;i<n;i++){var o=c[i];if(Y.copy(o.color),o.isDirectionalLight){var a=ee.setFromMatrixPosition(o.matrixWorld).normalize();if((s=r.dot(a))<=0)continue;s*=o.intensity,t.add(Y.multiplyScalar(s))}else if(o.isPointLight){var s;a=ee.setFromMatrixPosition(o.matrixWorld);if((s=r.dot(ee.subVectors(a,e).normalize()))<=0)continue;if(0==(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1)))continue;s*=o.intensity,t.add(Y.multiplyScalar(s))}}}(re,a.normalModel,D),D.multiply(G).add(X),!0===s.wireframe?se(D,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(D);else if(s.isMeshBasicMaterial||s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial){if(null!==s.map)s.map.mapping===THREE.UVMapping&&(x=a.uvs,pe(E,f,u,m,v,y,x[i].x,x[i].y,x[n].x,x[n].y,x[o].x,x[o].y,s.map));else null!==s.envMap?s.envMap.mapping===THREE.SphericalReflectionMapping&&(te.copy(a.vertexNormalsModel[i]).applyMatrix3(ie),R=.5*te.x+.5,T=.5*te.y+.5,te.copy(a.vertexNormalsModel[n]).applyMatrix3(ie),w=.5*te.x+.5,g=.5*te.y+.5,te.copy(a.vertexNormalsModel[o]).applyMatrix3(ie),S=.5*te.x+.5,H=.5*te.y+.5,pe(E,f,u,m,v,y,R,T,w,g,S,H,s.envMap)):(D.copy(s.color),s.vertexColors===THREE.FaceColors&&D.multiply(a.color),!0===s.wireframe?se(D,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(D))}else s.isMeshNormalMaterial?(te.copy(a.normalModel).applyMatrix3(ie),D.setRGB(te.x,te.y,te.z).multiplyScalar(.5).addScalar(.5)):D.setRGB(1,1,1),!0===s.wireframe?se(D,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(D)}function se(e,r,t,i){fe(r),ue(t),me(i),ve(e.getStyle()),B.stroke(),K.expandByScalar(2*r)}function le(e){ye(e.getStyle()),B.fill()}function ce(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var r=e.image;if(!1===r.complete)return{canvas:void 0,version:0};var t=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,n=e.wrapS===THREE.MirroredRepeatWrapping,o=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=r.width*(n?2:1),a.height=r.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,r.height),s.drawImage(r,0,0),!0==n&&(s.setTransform(-1,0,0,-1,r.width,r.height),s.drawImage(r,-r.width,0)),!0==o&&(s.setTransform(1,0,0,1,0,0),s.drawImage(r,0,r.height)),!0==n&&!0==o&&(s.setTransform(-1,0,0,1,r.width,0),s.drawImage(r,-r.width,r.height));var l="no-repeat";!0==t&&!0==i?l="repeat":!0==t?l="repeat-x":!0==i&&(l="repeat-y");var c=B.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function pe(e,r,t,i,n,o,a,s,l,c,p,d,h){var E=q[h.id];if(void 0!==E&&E.version===h.version||(E=ce(h),q[h.id]=E),void 0===E.canvas)return ye("rgba( 0, 0, 0, 1)"),void B.fill();ye(E.canvas);var f,u,m,v,y,x,R,T,w=h.offset.x/h.repeat.x,g=h.offset.y/h.repeat.y,S=h.image.width*h.repeat.x,H=h.image.height*h.repeat.y;l=(l+w)*S,c=(c+g)*H,p=(p+w)*S,d=(d+g)*H,t-=e,i-=r,n-=e,o-=r,0!=(R=(l-=a=(a+w)*S)*(d-=s=(s+g)*H)-(p-=a)*(c-=s))&&(y=e-(f=(d*t-c*n)*(T=1/R))*a-(m=(l*n-p*t)*T)*s,x=r-(u=(d*i-c*o)*T)*a-(v=(l*o-p*i)*T)*s,B.save(),B.transform(f,u,m,v,y,x),B.fill(),B.restore())}function de(e,r,t){var i,n=r.x-e.x,o=r.y-e.y,a=n*n+o*o;0!=a&&(n*=i=t/Math.sqrt(a),o*=i,r.x+=n,r.y+=o,e.x-=n,e.y-=o)}function he(e){a!==e&&(B.globalAlpha=e,a=e)}function Ee(e){N!==e&&(e===THREE.NormalBlending?B.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?B.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?B.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(B.globalCompositeOperation="multiply"),N=e)}function fe(e){F!==e&&(B.lineWidth=e,F=e)}function ue(e){U!==e&&(B.lineCap=e,U=e)}function me(e){I!==e&&(B.lineJoin=e,I=e)}function ve(e){W!==e&&(B.strokeStyle=e,W=e)}function ye(e){k!==e&&(B.fillStyle=e,k=e)}function xe(e){r.length!==e.length&&(B.setLineDash(e),r=e)}void 0===B.setLineDash&&(B.setLineDash=function(){}),this.domElement=i,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return B},this.getContextAttributes=function(){return B.getContextAttributes()},this.getPixelRatio=function(){return n},this.setPixelRatio=function(e){void 0!==e&&(n=e)},this.setSize=function(e,r,t){b=e*n,z=r*n,i.width=b,i.height=z,V=Math.floor(b/2),j=Math.floor(z/2),!1!==t&&(i.style.width=e+"px",i.style.height=r+"px"),$.min.set(-V,-j),$.max.set(V,j),J.min.set(-V,-j),J.max.set(V,j),a=1,N=0,I=U=F=k=W=null,this.setViewport(0,0,e,r)},this.setViewport=function(e,r,t,i){O=e*n,L=r*n,A=t*n,P=i*n},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,r){t.set(e),o=void 0!==r?r:1,J.min.set(-V,-j),J.max.set(V,j)},this.setClearColorHex=function(e,r){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,r)},this.getClearColor=function(){return t},this.getClearAlpha=function(){return o},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===J.isEmpty()&&(J.intersect($),J.expandByScalar(2),J.min.x=J.min.x+V,J.min.y=-J.min.y+j,J.max.x=J.max.x+V,J.max.y=-J.max.y+j,o<1&&B.clearRect(0|J.min.x,0|J.max.y,J.max.x-J.min.x|0,J.min.y-J.max.y|0),0<o&&(Ee(THREE.NormalBlending),he(1),ye("rgba("+Math.floor(255*t.r)+","+Math.floor(255*t.g)+","+Math.floor(255*t.b)+","+o+")"),B.fillRect(0|J.min.x,0|J.max.y,J.max.x-J.min.x|0,J.min.y-J.max.y|0)),J.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,r){if(void 0!==r.isCamera){var t=e.background;t&&t.isColor?(ye("rgb(0,0,0)"),B.fillRect(0,0,b,z)):!0===this.autoClear&&this.clear(),M.info.render.vertices=0,M.info.render.faces=0,B.setTransform(A/b,0,0,-P/z,O,z-L),B.translate(V,j),s=C.projectScene(e,r,this.sortObjects,this.sortElements),l=s.elements,c=s.lights,ie.getNormalMatrix(r.matrixWorldInverse),function(){Q.setRGB(0,0,0),Z.setRGB(0,0,0),_.setRGB(0,0,0);for(var e=0,r=c.length;e<r;e++){var t=c[e],i=t.color;t.isAmbientLight?Q.add(i):t.isDirectionalLight?Z.add(i):t.isPointLight&&_.add(i)}}();for(var i=0,n=l.length;i<n;i++){var o=l[i],a=o.material;if(void 0!==a&&0!==a.opacity){if(K.makeEmpty(),o instanceof THREE.RenderableSprite)(p=o).x*=V,p.y*=j,ne(p,o,a);else if(o instanceof THREE.RenderableLine)p=o.v1,d=o.v2,p.positionScreen.x*=V,p.positionScreen.y*=j,d.positionScreen.x*=V,d.positionScreen.y*=j,K.setFromPoints([p.positionScreen,d.positionScreen]),!0===$.intersectsBox(K)&&oe(p,d,o,a);else if(o instanceof THREE.RenderableFace){if(p=o.v1,d=o.v2,h=o.v3,p.positionScreen.z<-1||1<p.positionScreen.z)continue;if(d.positionScreen.z<-1||1<d.positionScreen.z)continue;if(h.positionScreen.z<-1||1<h.positionScreen.z)continue;p.positionScreen.x*=V,p.positionScreen.y*=j,d.positionScreen.x*=V,d.positionScreen.y*=j,h.positionScreen.x*=V,h.positionScreen.y*=j,0<a.overdraw&&(de(p.positionScreen,d.positionScreen,a.overdraw),de(d.positionScreen,h.positionScreen,a.overdraw),de(h.positionScreen,p.positionScreen,a.overdraw)),K.setFromPoints([p.positionScreen,d.positionScreen,h.positionScreen]),!0===$.intersectsBox(K)&&ae(p,d,h,0,1,2,o,a)}J.union(K)}}B.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var r,J,o,K,Q,Z,_,ee,n,re,te,t=[],i=0,ie=[],a=0,s=[],l=0,c=[],p=0,d=[],h=0,ne={objects:[],lights:[],elements:[]},oe=new THREE.Vector3,ae=new THREE.Vector4,u=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),m=new THREE.Box3,v=new Array(3),se=new THREE.Matrix4,le=new THREE.Matrix4,ce=new THREE.Matrix4,pe=new THREE.Matrix3,de=new THREE.Frustum,he=new THREE.Vector4,Ee=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var fe=new function(){var l=[],n=[],c=[],p=null,d=null,h=new THREE.Matrix3;function i(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(te),i.copy(t).applyMatrix4(le);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function E(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(v[0]=e.positionScreen,v[1]=r.positionScreen,v[2]=t.positionScreen,u.intersectsBox(m.setFromPoints(v)))}function f(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){d=(p=e).material,h.getNormalMatrix(p.matrixWorld),l.length=0,n.length=0,c.length=0},projectVertex:i,checkTriangleVisibility:E,checkBackfaceCulling:f,pushVertex:function(e,r,t){(o=ve()).position.set(e,r,t),i(o)},pushNormal:function(e,r,t){l.push(e,r,t)},pushColor:function(e,r,t){n.push(e,r,t)},pushUv:function(e,r){c.push(e,r)},pushLine:function(e,r){var t=ie[e],i=ie[r];t.positionScreen.copy(t.position).applyMatrix4(ce),i.positionScreen.copy(i.position).applyMatrix4(ce),!0===Te(t.positionScreen,i.positionScreen)&&(t.positionScreen.multiplyScalar(1/t.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(_=xe()).id=p.id,_.v1.copy(t),_.v2.copy(i),_.z=Math.max(t.positionScreen.z,i.positionScreen.z),_.renderOrder=p.renderOrder,_.material=p.material,p.material.vertexColors===THREE.VertexColors&&(_.vertexColors[0].fromArray(n,3*e),_.vertexColors[1].fromArray(n,3*r)),ne.elements.push(_))},pushTriangle:function(e,r,t){var i=ie[e],n=ie[r],o=ie[t];if(!1!==E(i,n,o)&&(d.side===THREE.DoubleSide||!0===f(i,n,o))){(Q=ye()).id=p.id,Q.v1.copy(i),Q.v2.copy(n),Q.v3.copy(o),Q.z=(i.positionScreen.z+n.positionScreen.z+o.positionScreen.z)/3,Q.renderOrder=p.renderOrder,Q.normalModel.fromArray(l,3*e),Q.normalModel.applyMatrix3(h).normalize();for(var a=0;a<3;a++){var s=Q.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(h).normalize(),Q.uvs[a].fromArray(c,2*arguments[a])}Q.vertexNormalsLength=3,Q.material=p.material,ne.elements.push(Q)}}}};function ue(e){(r=function(){if(J!==i)return t[J++];var e=new THREE.RenderableObject;return t.push(e),i++,J++,e}()).id=e.id,r.object=e,oe.setFromMatrixPosition(e.matrixWorld),oe.applyMatrix4(le),r.z=oe.z,r.renderOrder=e.renderOrder,ne.objects.push(r)}function me(e,r,t){var i=1/e.w;e.z*=i,-1<=e.z&&e.z<=1&&((n=function(){if(re!==h)return d[re++];var e=new THREE.RenderableSprite;return d.push(e),h++,re++,e}()).id=r.id,n.x=e.x*i,n.y=e.y*i,n.z=e.z,n.renderOrder=r.renderOrder,n.object=r,n.rotation=r.rotation,n.scale.x=r.scale.x*Math.abs(n.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),n.scale.y=r.scale.y*Math.abs(n.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),n.material=r.material,ne.elements.push(n))}function ve(){if(K!==a)return ie[K++];var e=new THREE.RenderableVertex;return ie.push(e),a++,K++,e}function ye(){if(Z!==l)return s[Z++];var e=new THREE.RenderableFace;return s.push(e),l++,Z++,e}function xe(){if(ee!==p)return c[ee++];var e=new THREE.RenderableLine;return c.push(e),p++,ee++,e}function Re(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function Te(e,r){var t=0,i=1,n=e.z+e.w,o=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;return 0<=n&&0<=o&&0<=a&&0<=s||!(n<0&&o<0||a<0&&s<0)&&(n<0?t=Math.max(t,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?t=Math.max(t,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<t)&&(e.lerp(r,t),r.lerp(e,1-i),!0))}this.projectScene=function(e,r,t,i){re=ee=Z=0,!(ne.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),se.copy(r.matrixWorldInverse),le.multiplyMatrices(r.projectionMatrix,se),de.setFromMatrix(le),J=0,ne.objects.length=0,ne.lights.length=0,function e(r){if(!1!==r.visible){if(r instanceof THREE.Light)ne.lights.push(r);else if(r instanceof THREE.Mesh||r instanceof THREE.Line||r instanceof THREE.Points){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===de.intersectsObject(r))return;ue(r)}else if(r instanceof THREE.Sprite){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===de.intersectsSprite(r))return;ue(r)}for(var t=r.children,i=0,n=t.length;i<n;i++)e(t[i])}}(e),!0===t&&ne.objects.sort(Re);for(var n=ne.objects,o=0,a=n.length;o<a;o++){var s=n[o].object,l=s.geometry;if(fe.setObject(s),te=s.matrixWorld,K=0,s instanceof THREE.Mesh){if(l instanceof THREE.BufferGeometry){var c=l.attributes,p=l.groups;if(void 0===c.position)continue;for(var d=0,h=($=c.position.array).length;d<h;d+=3)fe.pushVertex($[d],$[d+1],$[d+2]);if(void 0!==c.normal){var E=c.normal.array;for(d=0,h=E.length;d<h;d+=3)fe.pushNormal(E[d],E[d+1],E[d+2])}if(void 0!==c.uv){var f=c.uv.array;for(d=0,h=f.length;d<h;d+=2)fe.pushUv(f[d],f[d+1])}if(null!==l.index){var u=l.index.array;if(0<p.length)for(var m=0;m<p.length;m++){var v=p[m];for(d=v.start,h=v.start+v.count;d<h;d+=3)fe.pushTriangle(u[d],u[d+1],u[d+2])}else for(d=0,h=u.length;d<h;d+=3)fe.pushTriangle(u[d],u[d+1],u[d+2])}else for(d=0,h=$.length/3;d<h;d+=3)fe.pushTriangle(d,d+1,d+2)}else if(l instanceof THREE.Geometry){var y=l.vertices,x=l.faces,R=l.faceVertexUvs[0];pe.getNormalMatrix(te);for(var T=s.material,w=Array.isArray(T),g=0,S=y.length;g<S;g++){var H=y[g];if(oe.copy(H),!0===T.morphTargets)for(var M=l.morphTargets,C=s.morphTargetInfluences,b=0,z=M.length;b<z;b++){var V=C[b];if(0!==V){var j=M[b].vertices[g];oe.x+=(j.x-H.x)*V,oe.y+=(j.y-H.y)*V,oe.z+=(j.z-H.z)*V}}fe.pushVertex(oe.x,oe.y,oe.z)}for(var O=0,L=x.length;O<L;O++){var A=x[O];if(void 0!==(T=!0===w?s.material[A.materialIndex]:s.material)){var P=T.side,B=ie[A.a],N=ie[A.b],W=ie[A.c];if(!1!==fe.checkTriangleVisibility(B,N,W)){var k=fe.checkBackfaceCulling(B,N,W);if(P!==THREE.DoubleSide){if(P===THREE.FrontSide&&!1===k)continue;if(P===THREE.BackSide&&!0===k)continue}(Q=ye()).id=s.id,Q.v1.copy(B),Q.v2.copy(N),Q.v3.copy(W),Q.normalModel.copy(A.normal),!1!==k||P!==THREE.BackSide&&P!==THREE.DoubleSide||Q.normalModel.negate(),Q.normalModel.applyMatrix3(pe).normalize();for(var F=A.vertexNormals,U=0,I=Math.min(F.length,3);U<I;U++){var D=Q.vertexNormalsModel[U];D.copy(F[U]),!1!==k||P!==THREE.BackSide&&P!==THREE.DoubleSide||D.negate(),D.applyMatrix3(pe).normalize()}Q.vertexNormalsLength=F.length;var G=R[O];if(void 0!==G)for(var X=0;X<3;X++)Q.uvs[X].copy(G[X]);Q.color=A.color,Q.material=T,Q.z=(B.positionScreen.z+N.positionScreen.z+W.positionScreen.z)/3,Q.renderOrder=s.renderOrder,ne.elements.push(Q)}}}}}else if(s instanceof THREE.Line){if(ce.multiplyMatrices(le,te),l instanceof THREE.BufferGeometry){if(void 0!==(c=l.attributes).position){for(d=0,h=($=c.position.array).length;d<h;d+=3)fe.pushVertex($[d],$[d+1],$[d+2]);if(void 0!==c.color){var Y=c.color.array;for(d=0,h=Y.length;d<h;d+=3)fe.pushColor(Y[d],Y[d+1],Y[d+2])}if(null!==l.index)for(d=0,h=(u=l.index.array).length;d<h;d+=2)fe.pushLine(u[d],u[d+1]);else{var q=s instanceof THREE.LineSegments?2:1;for(d=0,h=$.length/3-1;d<h;d+=q)fe.pushLine(d,d+1)}}}else if(l instanceof THREE.Geometry){if(0===(y=s.geometry.vertices).length)continue;(B=ve()).positionScreen.copy(y[0]).applyMatrix4(ce);for(q=s instanceof THREE.LineSegments?2:1,g=1,S=y.length;g<S;g++)(B=ve()).positionScreen.copy(y[g]).applyMatrix4(ce),0<(g+1)%q||(N=ie[K-2],he.copy(B.positionScreen),Ee.copy(N.positionScreen),!0===Te(he,Ee)&&(he.multiplyScalar(1/he.w),Ee.multiplyScalar(1/Ee.w),(_=xe()).id=s.id,_.v1.positionScreen.copy(he),_.v2.positionScreen.copy(Ee),_.z=Math.max(he.z,Ee.z),_.renderOrder=s.renderOrder,_.material=s.material,s.material.vertexColors===THREE.VertexColors&&(_.vertexColors[0].copy(s.geometry.colors[g]),_.vertexColors[1].copy(s.geometry.colors[g-1])),ne.elements.push(_)))}}else if(s instanceof THREE.Points){if(ce.multiplyMatrices(le,te),l instanceof THREE.Geometry)for(g=0,S=(y=s.geometry.vertices).length;g<S;g++){H=y[g];ae.set(H.x,H.y,H.z,1),ae.applyMatrix4(ce),me(ae,s,r)}else if(l instanceof THREE.BufferGeometry){if(void 0!==(c=l.attributes).position){var $;for(d=0,h=($=c.position.array).length;d<h;d+=3)ae.set($[d],$[d+1],$[d+2],1),ae.applyMatrix4(ce),me(ae,s,r)}}}else s instanceof THREE.Sprite&&(ae.set(te.elements[12],te.elements[13],te.elements[14],1),ae.applyMatrix4(le),me(ae,s,r))}return!0===i&&ne.elements.sort(Re),ne}},0<$("#canvasb").length){var container,stats,camera,scene,renderer,particles,particle,SEPARATION=200,AMOUNTX=40,AMOUNTY=60,count=0,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2;init(),animate()}function init(){container=$("#canvasb"),(camera=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e4)).position.z=1e4,(scene=new THREE.Scene).fog=new THREE.Fog(16777215,2e3,1e4),particles=new Array;for(var r=2*Math.PI,e=new THREE.SpriteCanvasMaterial({color:2170687,program:function(e){e.beginPath(),e.arc(0,0,.5,0,r,!0),e.fill()}}),t=0,i=0;i<AMOUNTX;i++)for(var n=0;n<AMOUNTY;n++)(particle=particles[t++]=new THREE.Sprite(e)).position.x=i*SEPARATION-AMOUNTX*SEPARATION/2,particle.position.z=n*SEPARATION-AMOUNTY*SEPARATION/2,scene.add(particle);(renderer=new THREE.CanvasRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(scene.fog.color),container.append(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate),render()}function render(){camera.position.set(0,355,122);for(var e=0,r=0;r<AMOUNTX;r++)for(var t=0;t<AMOUNTY;t++)(particle=particles[e++]).position.y=50*Math.sin(.3*(r+count))+50*Math.sin(.5*(t+count)),particle.scale.x=particle.scale.y=4*(Math.sin(.3*(r+count))+1)+4*(Math.sin(.5*(t+count))+1);renderer.render(scene,camera),count+=.1}